---
{"tags":["Protocol"],"dg-publish":true,"dg-path":"IoT/MQTT.md","permalink":"/IoT/MQTT/","dgPassFrontmatter":true,"noteIcon":"","created":"2024-10-12T17:16:53.170+08:00","updated":"2025-05-02T16:52:16.433+08:00"}
---

(website::https://mqtt.org/)
(terminology::**Message Queuing Telemetry Transport**)  消息队列遥测传输
>“ Is often used in IoT applications where resource - constrained devices need to communicate over unreliable networks.”

是一种轻量级、基于发布-订阅模式的消息传输协议，专为资源受限设备通过不可靠网络进行通信而设计，因而在物联网（[[IoT\|IoT]]）领域被广泛采用。

它工作在 TCP/IP 协议族之上，依赖 [[TCP\|TCP]] 提供的可靠传输机制，保障消息的有序性与完整性，同时通过极简的报文结构和传输开销，优化了在低带宽、高延迟或不稳定环境下的通信性能。这使得 MQTT 成为远程通信与物联网应用的理想选择。

MQTT 的核心设计思想是通过 **代理（Broker）** 实现通信双方的解耦，发布者与订阅者之间无需直接建立连接，而是通过代理进行消息转发，从而提升系统的扩展性、灵活性与容错性。

### 一、基本概念
- **主题（Topic）**：消息传递的逻辑通道，用于标识消息类别或路由路径，采用类似多层路径的字符串表示（如 `sensor/temperature`）。
- **消息（Message）**：协议中的基本数据单元，包含有效载荷（Payload）及相关元数据，可灵活承载结构化或非结构化信息。
- **客户端（Client）**：指可向主题发布消息或从主题订阅消息的终端设备或应用程序，既可以作为数据生产者，也可以作为数据消费者。
- **代理（Broker）**：MQTT 服务器，负责接收客户端发布的消息、按照主题规则进行过滤，并将符合条件的消息分发给订阅了相应主题的客户端，保证消息在系统中的可达性与一致性。
- **服务质量（QoS）**：MQTT 定义了三种消息传输的服务质量级别，满足不同应用对可靠性的需求：
    - **QoS 0（最多一次）**：消息发送不确认，可能丢失但不会重复，适用于对实时性要求高但能容忍丢失的场景。
    - **QoS 1（至少一次）**：消息至少传递一次，可能重复，适用于消息丢失不可接受但可接受重复的场景。
    - **QoS 2（只有一次）**：确保消息精确传递一次，通过四阶段握手避免重复，适用于金融、计费等要求绝对可靠的场景。

### 二、MQTT 协议演进
#### MQTT 3.1  （ 2010）
MQTT 3.1 是最早公开文档化的协议版本，由 IBM 发布。该版本奠定了 MQTT 的基础架构与通信机制，具有以下关键特性：
- 基于 **发布/订阅** 的消息模式
- 通过 **TCP** 进行可靠传输
- 支持 **三个 QoS 级别（0、1、2）**，满足不同可靠性需求
- 保持会话机制（Keep Alive）
- 简单的连接认证（用户名、密码字段）
然而，该版本在标准化程度、安全性、错误处理等方面存在局限，例如缺乏标准化的错误码、无法支持扩展字段等。

#### MQTT 3.1.1 （ 2014 ）
MQTT 3.1.1 是 MQTT 进入标准化阶段的标志性版本，由 OASIS 组织推动并发布，属于**修订优化版本**，其改进主要体现在以下方面：
- **协议标准化**：在 OASIS 框架下规范化，确保跨厂商、跨平台兼容  
- **错误处理增强**：明确了连接时客户端标识（Client ID）为空时代理的行为、增加对非法报文的关闭连接处理  
- **协议一致性**：对可选字段、标志位、协议行为等进行了明确约束，减少不同实现的歧义  
- **支持 WebSocket 传输**（通过第三方实现）

#### MQTT 5.0 （ 2019 ）
MQTT 5.0 是协议体系中的 **重要升级版本**，引入了大量针对实际应用需求的增强功能，核心在于提升协议的 **可扩展性、诊断性、安全性、复杂消息流支持能力**。其关键改进包括：

- **属性机制（Properties）**：在连接、订阅、发布、取消订阅等操作中引入可扩展属性字段（Key-Value 结构），允许添加自定义或标准扩展信息，解决了 3.x 无法向消息中附加元数据的问题
- **错误报告机制**：增加了 **Reason Code、Reason String**，可对操作失败原因进行精细化分类和描述，提高了调试与错误诊断效率
- **会话和消息过期**
	- 引入 **Session Expiry Interval**：允许指定会话在客户端断开后保留的时长
	- 引入 **Message Expiry Interval**：为消息定义过期时间，确保数据时效性
 - **共享订阅（Shared Subscriptions）**：多个客户端可共享同一订阅，实现消息负载均衡分发，适用于高并发场景
 - **主题别名（Topic Alias）**：允许用整数替代长字符串主题，减少报文长度，优化低带宽网络下性能
 - **流控机制（Flow Control）**：引入 **Maximum Packet Size、Receive Maximum** 等控制参数，提升在资源受限环境下的可控性
 - **增强认证机制**：新增 **Enhanced Authentication**：支持多步骤认证流程（如基于 SASL、OAuth 的挑战响应机制）
 - **用户属性（User Properties）**：允许在消息中添加自定义键值对，支持复杂应用场景中自定义数据交换

虽然 5.0 与 3.1.1 在基本通信流程上兼容，但由于报文结构有较大变化，部分老版本客户端/代理无法直接支持 5.0 报文，需要明确配置或升级以启用。
### 实际应用
实际部署中，MQTT 已成为智慧城市、工业物联网、智能家居、远程监控等领域的关键通信协议。例如，使用 [[mosquitto\|mosquitto]] 等开源实现，可在边缘计算节点快速搭建高性能 MQTT 代理，实现大规模设备的消息交互。通过与 [[Node-RED\|Node-RED]]等平台集成，还可进一步实现数据可视化、事件驱动处理和实时响应。

随着协议标准的更新（如 MQTT 5.0 的引入），包括 会话过期（Session Expiry）、消息过期（Message Expiry）、共享订阅（Shared Subscriptions）、主题别名（Topic Alias） 等新功能，为处理复杂物联网场景提供了更多灵活的配置选项，也对协议的可扩展性与安全性提出了更高要求。

在安全性方面，尽管 MQTT 在最初未强制加密传输，但实践中推荐结合 TLS/SSL 实现端到端加密，防止数据在传输过程中被截获或篡改，同时借助客户端认证和访问控制机制（如基于角色的访问控制 RBAC）加强系统防护。

综上，MQTT 凭借其轻量、高效、灵活及持续演进的特性，已成为物联网通信领域的重要支柱，在面向 边缘计算、大规模设备管理 和 跨网络环境集成 的新兴应用中展现出强大潜力。

(website::https://www.runoob.com/w3cnote/mqtt-intro.html)

